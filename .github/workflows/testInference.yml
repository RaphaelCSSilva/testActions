name: Friendly AI reply to comments (with GitHub MCP)

on:
  issue_comment:
    types: [created]

permissions:
  contents: read
  issues: write
  pull-requests: write
  models: read

jobs:
  reply:
    if: ${{ github.actor != 'github-actions[bot]' }}
    runs-on: ubuntu-latest

    steps:
      - name: Draft a natural reply with GitHub Models (MCP enabled)
        id: ai
        uses: actions/ai-inference@v2
        with:
          # Optional: pick a faster model
          model: openai/gpt-4o-mini
          enable-github-mcp: true
          # Use the default workflow token for normal GitHub API reads
          token: ${{ secrets.GITHUB_TOKEN }}
          # Separate user PAT for MCP tool calls (set this in repo/org secrets)
          github-mcp-token: ${{ secrets.GH_MCP_PAT }}
          system-prompt: >
            You are a helpful, concise maintainer assistant.
            Read the user's comment and write a brief, friendly reply (max 60 words)
            that matches their tone and moves the conversation forward.
            Output ONLY the reply text (no labels, no code fences).
          prompt: |
            Comment by @${{ github.event.comment.user.login }} on "${{ github.event.issue.title }}":
            ---
            ${{ github.event.comment.body }}
            ---
            Repo: ${{ github.repository }}

      - name: Post reply
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = context.payload.issue.number;
            const reply = ${{ toJSON(steps.ai.outputs.response) }};
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number,
              body: reply
            });
